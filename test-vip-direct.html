<!DOCTYPE html>
<html>
<head>
  <title>VIP Levels Test</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Testing VIP Levels Direct Access</h1>
  <button onclick="testAsAnon()">Test as Anonymous</button>
  <button onclick="testAsAuth()">Test as Authenticated</button>
  <button onclick="loginTestUser()">Login Test User</button>
  <pre id="output"></pre>

  <script>
    const SUPABASE_URL = 'https://uzbyrciresvwcumrzdnn.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV6YnlyY2lyZXN2d2N1bXJ6ZG5uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUzNTY5MjcsImV4cCI6MjA4MDkzMjkyN30.r1tMK1UCIeFq3f3uuYSufLedHjQPY-AhM8BcnSVhHbw';

    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const output = document.getElementById('output');

    function log(msg) {
      output.textContent += msg + '\n';
      console.log(msg);
    }

    async function testAsAnon() {
      output.textContent = '';
      log('=== Testing as ANONYMOUS ===');

      try {
        const { data: session } = await supabase.auth.getSession();
        log('Current session: ' + JSON.stringify(session));

        log('\nFetching vip_levels with is_active=true...');
        const { data, error } = await supabase
          .from('vip_levels')
          .select('*')
          .eq('is_active', true)
          .order('level');

        if (error) {
          log('ERROR: ' + JSON.stringify(error, null, 2));
        } else {
          log('SUCCESS! Got ' + (data?.length || 0) + ' records');
          log('Data: ' + JSON.stringify(data, null, 2));
        }
      } catch (err) {
        log('EXCEPTION: ' + err.message);
      }
    }

    async function loginTestUser() {
      output.textContent = '';
      log('=== Logging in test user ===');

      const email = prompt('Enter email:');
      const password = prompt('Enter password:');

      try {
        const { data, error } = await supabase.auth.signInWithPassword({
          email,
          password
        });

        if (error) {
          log('Login ERROR: ' + error.message);
        } else {
          log('Login SUCCESS!');
          log('User: ' + JSON.stringify(data.user, null, 2));
        }
      } catch (err) {
        log('Login EXCEPTION: ' + err.message);
      }
    }

    async function testAsAuth() {
      output.textContent = '';
      log('=== Testing as AUTHENTICATED ===');

      try {
        const { data: sessionData } = await supabase.auth.getSession();
        log('Current session: ' + (sessionData?.session ? 'LOGGED IN' : 'NOT LOGGED IN'));
        log('User ID: ' + sessionData?.session?.user?.id);

        log('\nFetching vip_levels with is_active=true...');
        const { data, error } = await supabase
          .from('vip_levels')
          .select('*')
          .eq('is_active', true)
          .order('level');

        if (error) {
          log('ERROR: ' + JSON.stringify(error, null, 2));
        } else {
          log('SUCCESS! Got ' + (data?.length || 0) + ' records');
          log('Data: ' + JSON.stringify(data, null, 2));
        }
      } catch (err) {
        log('EXCEPTION: ' + err.message);
      }
    }
  </script>
</body>
</html>
